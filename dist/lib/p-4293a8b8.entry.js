import{r as t,h as i,H as e,g as r}from"./p-3aa6a5c3.js";import{b as n}from"./p-01af54ad.js";import{i as o,g as a,a as s}from"./p-fe3761e7.js";var c="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,h=c||l||Function("return this")(),u=h.Symbol,f=Object.prototype,d=f.hasOwnProperty,g=f.toString,v=u?u.toStringTag:void 0,m=Object.prototype.toString,p=u?u.toStringTag:void 0;var w=/\s/,b=/^\s+/;function y(t){var i=typeof t;return null!=t&&("object"==i||"function"==i)}var _=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,x=/^0o[0-7]+$/i,T=parseInt;function $(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?function(t){var i=d.call(t,v),e=t[v];try{t[v]=void 0;var r=!0}catch(t){}var n=g.call(t);return r&&(i?t[v]=e:delete t[v]),n}(t):function(t){return m.call(t)}(t)}(t)}(t))return NaN;if(y(t)){var i="function"==typeof t.valueOf?t.valueOf():t;t=y(i)?i+"":i}if("string"!=typeof t)return 0===t?t:+t;var e;t=(e=t)?e.slice(0,function(t){for(var i=t.length;i--&&w.test(t.charAt(i)););return i}(e)+1).replace(b,""):e;var r=j.test(t);return r||x.test(t)?T(t.slice(2),r?2:8):_.test(t)?NaN:+t}var E,H=function(){return h.Date.now()},N=Math.max,O=Math.min;!function(t){t.NONE="none",t.CONTAIN="contain",t.COVER="cover",t.FILL="fill",t.SCALE_DOWN="scale-down"}(E||(E={}));const W=class{constructor(i){t(this,i),this.lazy=!1,this.fit="none",this.placeholder="加载中...",this.errorText="加载失败",this.loading=!0,this.error=!1,this.show=!1,this.isSupportObjectFit=()=>void 0!==document.documentElement.style.objectFit}watchHandler(t,i){i||this.loadImage()}handleScroll(){this.lazy&&this._handleLazyLoad()}handleLoad(t,i){this.imageWidth=i.width,this.imageHeight=i.height,this.loading=!1,this.error=!1}handleError(t){console.error(t),this.loading=!1,this.error=!0}loadImage(){if(!this.src)return!1;this.loading=!0,this.error=!1;const t=new Image;return t.onload=i=>this.handleLoad(i,t),t.onerror=this.handleError.bind(this),t.src=this.src,!0}getImageStyle(){if(this.isSupportObjectFit())return{objectFit:this.fit};const{fit:t,imageWidth:i,imageHeight:e,element:r}=this,{clientWidth:n,clientHeight:o}=r;let a=t;if(!(i&&e&&n&&o))return{};const s=i/e,c=n/o;switch(t===E.SCALE_DOWN&&(a=i<n&&e<o?E.NONE:E.CONTAIN),a){case E.NONE:return{width:"auto",height:"auto"};case E.CONTAIN:return s<c?{width:"auto"}:{height:"auto"};case E.COVER:return s<c?{height:"auto"}:{width:"auto"};default:return{}}}handleLazyLoad(){this.show||o(this.element,this._scrollContainer)&&(this.show=!0)}componentWillLoad(){this.lazy||this.loadImage(),this.getImageStyle=this.getImageStyle.bind(this),this.handleLazyLoad=this.handleLazyLoad.bind(this),this._scrollContainer=a(this.element),this._handleLazyLoad=function(t,i,e){var r=!0,n=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return y(e)&&(r="leading"in e?!!e.leading:r,n="trailing"in e?!!e.trailing:n),function(t,i,e){var r,n,o,a,s,c,l=0,h=!1,u=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function d(i){var e=r,o=n;return r=n=void 0,l=i,a=t.apply(o,e)}function g(t){return l=t,s=setTimeout(m,i),h?d(t):a}function v(t){var e=t-c;return void 0===c||e>=i||e<0||u&&t-l>=o}function m(){var t=H();if(v(t))return p(t);s=setTimeout(m,function(t){var e=i-(t-c);return u?O(e,o-(t-l)):e}(t))}function p(t){return s=void 0,f&&r?d(t):(r=n=void 0,a)}function w(){var t=H(),e=v(t);if(r=arguments,n=this,c=t,e){if(void 0===s)return g(c);if(u)return clearTimeout(s),s=setTimeout(m,i),d(c)}return void 0===s&&(s=setTimeout(m,i)),a}return i=$(i)||0,y(e)&&(h=!!e.leading,o=(u="maxWait"in e)?N($(e.maxWait)||0,i):o,f="trailing"in e?!!e.trailing:f),w.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=n=s=void 0},w.flush=function(){return void 0===s?a:p(H())},w}(t,200,{leading:r,maxWait:200,trailing:n})}(this.handleLazyLoad)}render(){const{src:t,loading:r,error:o,placeholder:a,errorText:c}=this,l=this.getImageStyle(),h=s("image"),u=n(h);return i(e,{style:{display:"block"},class:u},!r&&!o&&i("img",{src:t,alt:"",style:l,class:`${u}__inner`}),r&&i("div",{class:`${u}__placeholder`},a),o&&i("div",{class:`${u}__placeholder`},c))}get element(){return r(this)}static get watchers(){return{show:["watchHandler"]}}};W.style=".w-image__error,.w-image__inner,.w-image__placeholder{width:100%;height:100%}.w-image{position:relative;display:inline-block;overflow:hidden}.w-image__inner{vertical-align:top}.w-image__placeholder{background:var(--w-fill-color-light)}.w-image__error{display:flex;justify-content:center;align-items:center;font-size:14px;background:var(--w-fill-color-light);color:var(--w-text-color-placeholder);vertical-align:middle}.w-image__preview{cursor:pointer}.w-image__placeholder{display:flex;align-items:center;justify-content:center}";export{W as w_image}